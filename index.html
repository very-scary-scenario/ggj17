<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Idol Threat</title>
    <link rel="stylesheet" href="style.css"/>
    <link rel="apple-touch-icon" href="icon.png" />

    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <meta name="apple-mobile-web-app-status-bar-style" content="white"/>

    <script>
      var PARTS;
      var PART_INDEX;
      var BIOS;
      var QUOTES;
      var ABILITIES;
      var ANIMATIONS;
      var CAMPAIGN;
      var UNIT_NAMES;
      var KANA;
      var GRADUATION_BONUSSES;
    </script>
  </head>
  <body class="nothing-scanned">
    <header id="title">
      <h1>Idol Threat</h1>
      <p id="loading">You need to turn Javascript on to play</p>
      <script>
        document.getElementById('loading').innerText = 'Loading…';
      </script>
    </header>

    <section id="catalog">
    </section>

    <section id="unit" class="empty">
    </section>

    <section id="idol-detail">
    </section>

    <section id="battle">
    </section>

    <section id="canteen">
    </section>

    <section id="theatre">
    </section>

    <section id="prompt-area">
    </section>

    <section id="audition-space">
    </section>

    <input type="file" accept="image/*" capture="camera" id="barcode-image"/>

    <script id="catalog-template" type="text/x-handlebars-template">
      <ul id="menu">
        <li><a href="#" class="needsclick" id="recruit">Scan a barcode to recruit a new member…</a></li>
        {{#if catalog}}
          <li><a href="#" class="needsclick" id="fight">Quick battle!</a></li>
          {{#if hasStoryRemaining}}
            <li><a href="#" class="needsclick" id="progress-story">Attempt next story chapter…</a></li>
          {{/if}}
        {{else}}
          <li><a href="#" class="needsclick" id="random-fight">Fight a random, consequence-free battle…</a></li>
        {{/if}}
      </ul>

      <div id="sort-orders">
        <a href="#" id="sort-button">sort…</a>
        <ul id="sort-list">
          {{#each sortOrders}}
            <li>
              {{#if isSelectedOrder}}
                <a>{{1}} <em>(current)</em></a>
              {{else}}
                <a href="#" data-sort-order="{{0}}">{{1}}</a>
              {{/if}}
            </li>
          {{/each}}
        </ul>
      </div>

      <ul class="catalog">
        {{#each catalog}}
          <li data-index="{{@index}}" class="idol {{#if isInUnit}}active{{/if}} affinity-{{affinity}}">
            <div class="portrait">{{{thumbSpriteHTML}}}</div>
            <div data-index="{{@index}}" class="input"></div>
          </li>
        {{/each}}
      </ul>

      <div id="signature">
        <a href="https://vscary.co/"><img alt="a Very Scary Scenario project" src="https://vscary.co/logo-black.svg"/></a>
        <ul>
          <li><a href="https://vscary.co/">vscary.co</a></li>
          <li><a href="https://github.com/very-scary-scenario/idol-threat">help &amp; source</a></li>
        </ul>
      </div>
    </script>

    <script id="idol-detail-template" type="text/x-handlebars-template">
      <div class="portrait">
        {{{hugeSpriteHTML}}}
      </div>
      <div class="summary">
        <div class="nametag bubble">
          <h2 class="name affinity-{{affinity}}">{{name}}</h2>
          <div class="membership">
            <span>Is in unit</span>
            <div data-index="{{@index}}" class="input {{#if isInUnit}}active{{/if}}"/></div>
          </div>
        </div>
        <div class="stats bubble">
          <dl>
            <dt>Attack</dt>
            <dd>{{attack}} +{{attackBonus}}</dd>
            <dt>Defense</dt>
            <dd>{{defense}} +{{defenseBonus}}</dd>
            <dt>Speed</dt>
            <dd>{{speed}} +{{speedBonus}}</dd>
            <dt>Endurance</dt>
            <dd>{{endurance}} +{{enduranceBonus}}</dd>
          </dl>
          <p class="rarity">{{rarity}}</p>
        </div>
        <div class="abilities bubble">
          <ul>
            {{#each abilities}}<li class="affinity-{{affinity}}">{{name}}</li>{{/each}}
          </ul>
        </div>
        <ul class="actions">
          {{#if canFeed}}
            <li><a class="feed" href="#">“Train”</a></li>
          {{/if}}
          <li><a class="graduate" href="#">Graduate…</a></li>
        </ul>
      </div>
      <div class="bubble bio">
        <p>{{bio}}</p>
        <blockquote>“{{quote}}”</blockquote>
      </div>
      <a class="close" href="#">close</p>
    </script>

    <script id="unit-template" type="text/x-handlebars-template">
      <h2>{{unitName}}</h2>
      <ul class="unit">
        {{#each unit}}
          <li class="needsclick" data-index="{{@index}}">
            <div class="portrait">
              {{{thumbSpriteHTML}}}
            </div>
          </li>
        {{/each}}
      </ul>
    </script>

    <script id="sprite-template" type="text/x-handlebars-template">
      <div class="sprite">
        <img data-sprite-{{mode}}-id="{{identifier}}" class="needsclick" src="{{sprite}}"/>
      </div>
    </script>

    <script id="battle-template" type="text/x-handlebars-template">
      <form id="battle-form">
        <ul class="idol-list" id="enemy-idols">
          {{#each enemyIdols}}
            <li data-index="{{@index}}" class="affinity-{{affinity}}">
              <label>
                <input required type="radio" name="target" value="{{@index}}"></input>
                <div class="portrait">
                  {{{thumbSpriteHTML}}}
                </div>
                {{{healthBar}}}
              </label>
              <div class="name affinity-{{affinity}}"><span>{{idol.name}}</span></div>
            </li>
          {{/each}}
        </ul>

        <div id="ability-prompt">
        </div>

        <ul class="idol-list" id="player-idols">
          {{#each playerIdols}}
            <li data-index="{{@index}}" class="affinity-{{affinity}}">
              <div class="portrait">
                {{{thumbSpriteHTML}}}
              </div>
              {{{healthBar}}}
              <div class="name affinity-{{affinity}}"><span>{{idol.name}}</span></div>
            </li>
          {{/each}}
        </ul>
      </form>
    </script>

    <script id="health-bar-template" type="text/x-handlebars-template">
      <div class="health-bar affinity-{{affinity}}">
        <div class="health-bar-content" style="width: {{healthPercent}}%;"></div>
        <div class="health-bar-trail" style="width: {{healthPercent}}%;"></div>
      </div>
    </script>

    <script id="ability-prompt-template" type="text/x-handlebars-template">
      <p>What will {{idol.name}} do?</p>

      <ul>
        {{#each abilities}}
          <li>
            <label class="affinity-{{affinity}}"><input required type="radio" name="move" value="{{@index}}"/>{{name}}</label>
          </li>
        {{/each}}

        <input type="hidden" name="move" value="{{@index}}"/>
      </ul>

      <p>Also, pick a target from the enemy unit.</p>

      <button data-affinity="{{affinity}}" type="subit">Fight!</button>
    </script>

    <script id="prompt-template" type="text/x-handlebars-template">
      <div id="prompt-backdrop">
        <div id="prompt">
          <p>{{question}}</p>
          <ul>
            {{#each answers}}
              <li><a class="needsclick" href="#" data-answer-index="{{@index}}">{{0}}</a></li>
            {{/each}}
          </ul>
        </div>
      </div>
    </script>

    <script id="canteen-template" type="text/x-handlebars-template">
      <div id="buffet">
        <a href="#" class="cancel">cancel</a>
        <h2>Who do you want {{idol.name}} to “train with”?</h2>
        
        <ul class="catalog">
          {{#each catalog}}
            <li data-index="{{@index}}" class="idol {{#if isInUnit}}active{{/if}} affinity-{{affinity}}">
              <div class="portrait">{{{thumbSpriteHTML}}}</div>
            </li>
          {{/each}}
        </ul>
      </div>
    </script>

    <script id="canteen-confirm-template" type="text/x-handlebars-template">
      <div id="buffet">
        <h2>Are you sure you want {{idol.name}} to “train with” {{food.name}}?</h2>
        <p>{{food.name}} will go on, uhh, “holiday”, and {{idol.name}}'s base stats will be changed as follows:</p>
        <dl>
          <dt>Attack</dt>
          <dd>{{idol.attack}} + {{food.attack}}{{#if negativeStats.attack}}/2{{/if}} = <strong>{{summedStats.attack}}</strong></dd>
          <dt>Defense</dt>
          <dd>{{idol.defense}} + {{food.defense}}{{#if negativeStats.defense}}/2{{/if}} = <strong>{{summedStats.defense}}</strong></dd>
          <dt>Speed</dt>
          <dd>{{idol.speed}} + {{food.speed}}{{#if negativeStats.speed}}/2{{/if}} = <strong>{{summedStats.speed}}</strong></dd>
          <dt>Endurance</dt>
          <dd>{{idol.endurance}} + {{food.endurance}}{{#if negativeStats.endurance}}/2{{/if}} = <strong>{{summedStats.endurance}}</strong></dd>
        </dl>

        <p class="actions"><a href="#" class="yes">Yes, “train”</a> <a href="#" class="no">No, it's okay</a></p>
      </div>
    </script>

    <script id="theatre-template" type="text/x-handlebars-template">
      <div id="stage">
        <div id="backdrop" style="background-image: url('backgrounds/processed/{{background}}.jpg');">
        </div>
        <div id="script" class="needsclick">
          {{text}}
        </div>
      </div>
    </script>

    <script id="audition-template" type="text/x-handlebars-template">
      <div id="audition" class="affinity-{{affinity}}">
        <h2 class="affinity-{{affinity}}">{{name}}</h2>
        <div class="portrait"></div>
        <p id="catch-button-container">
          <a href="#" id="catch-button">Recruit!</a>
        </p>
      </div>
    </script>

    <script src="lib/fastclick/fastclick.js"></script>
    <script src="lib/quagga/quagga.min.js"></script>
    <script src="lib/handlebars/handlebars.min.js"></script>
    <script src="lib/confetti/confetti.js"></script>
    <script src="parts.js"></script>
    <script src="battle.js"></script>
    <script src="game.js"></script>
  </body>
</html>
